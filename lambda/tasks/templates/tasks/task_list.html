{% extends 'base/base.html' %}
{% load static %}

{% block title %}
<title>Tasks | Lambda</title>
{% endblock title %}

{% block content %}

<div class="container mb-3">
  <div class="row mb-3">
    <div class="col">
      {% if messages %}
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
      {% endfor %}
      {% endif %}
    </div>
  </div>

  <div class="row mb-3">
    <div class="col">
      <a class="btn btn-primary float-right" href="{% url 'task-create' %}">
        <h4 class="mb-0">New task</h4>
      </a>
    </div>
  </div>

  <table id="sortTable1" class="table table-hover">
    <thead>
      <tr>
        <th class="sortHeader" data-sorted="true" data-table-id="sortTable1" data-col="0" data-type="number"
          scope="col">
          #
        </th>
        <th class="sortHeader" data-sorted="false" data-table-id="sortTable1" data-col="1" data-type="text" scope="col">
          Title
        </th>
        <th class="sortHeader" data-sorted="false" data-table-id="sortTable1" data-col="2" data-type="text" scope="col">
          Project
        </th>
        <th class="sortHeader" data-sorted="false" data-table-id="sortTable1" data-col="3" data-type="text" scope="col">
          Assigned to
        </th>
        <th class="sortHeader" data-sorted="false" data-table-id="sortTable1" data-col="4" data-type="number"
          scope="col">
          Priority
        </th>
        <th class="sortHeader" data-sorted="false" data-table-id="sortTable1" data-col="5" data-type="number"
          scope="col">
          Due in
        </th>
      </tr>
    </thead>
    <tbody>
      {% for task in object_list %}
      <tr onclick="window.document.location='{% url 'task-detail' task.id %}';"
        {% if task.completed %}class="table-success" {% endif %}>
        <th scope="row">{{ task.id }}</th>
        <td>{{ task.title }}</td>
        <td>{{ task.assigned_to_project }}</td>
        <td>{{ task.assigned_to_user }}</td>
        {% if task.priority_level <= 3 %}
        <td class="text-success" data-sort-value="{{ task.priority_level }}">{{ task.get_priority_level_display }}</td>
        {% elif task.priority_level <= 6 %}
        <td class="text-warning" data-sort-value="{{ task.priority_level }}">{{ task.get_priority_level_display }}</td>
        {% elif task.priority_level <= 9 %}
        <td class="text-danger" data-sort-value="{{ task.priority_level }}">{{ task.get_priority_level_display }}</td>
        {% endif %}
        <td data-sort-value="{{ task.days_till_due }}">{{ task.days_till_due }}&nbsp;days</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>
<script src="{% static 'tasks/tableFunctions.js' %}"></script>
{% endblock content %}
