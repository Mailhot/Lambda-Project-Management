{% extends 'base/base_detail.html' %}

{% load duration_filters %}

{% block title %}
  <title>Task {{ task.id }} | Lambda</title>
{% endblock title %}

{% block nav %}
  {% include 'tasks/task_nav.html' %}
{% endblock nav %}



{% block cardContent %}
  <div class="card-header">
    <h2>#{{ task.id }}&emsp;{{ task.title }}</h2>
  </div>
  <ul class="list-group list-group-horizontal">
    <li class="list-group-item flex-fill"><strong>Project:</strong>&emsp;{{ task.assigned_to_project }}</li>
    <li class="list-group-item flex-fill"><strong>Assigned to:</strong>&emsp;<a href="{% url 'profile' task.assigned_to_user %}">{{ task.assigned_to_user }}</a></li>
  </ul>
  <div class="card-body">
    <h4>Detail</h4>
    <p>
      {{ task.description }}
    </p>
  </div>
  <ul class="list-group">
    <li
      {% if task.priority_level <= 3 %}
        class="list-group-item list-group-item-success"
      {% elif task.priority_level <= 6 %}
        class="list-group-item list-group-item-warning"
      {% elif task.priority_level <= 9 %}
        class="list-group-item list-group-item-danger"
      {% endif %}>
      <strong>Priority:</strong>&emsp;{{ task.get_priority_level_display }}
    </li>
    <li class="list-group-item"><strong>Estimated duration:</strong>&emsp;{{ task.estimated_duration|readable_duration:"{hours}h {minutes}min" }}</li>
    <li class="list-group-item">
      <strong>Date created:</strong>&emsp;{{ task.date_created }}&emsp;
      <strong>Created by:</strong>&emsp;<a href="{% url 'profile' task.created_by %}">{{ task.created_by }}</a>
    </li>
    <li class="list-group-item">
      <strong>Last modified:</strong>&emsp;{{ task.date_modified }}&emsp;
      <strong>Modified by:</strong>&emsp;<a href="{% url 'profile' task.modified_by %}">{{ task.modified_by }}</a>
    </li>
    <li class="list-group-item"><strong>Due:</strong>&emsp;{{ task.date_due }}&emsp;({{ task.date_due|timeuntil }})</li>
  </ul>
  <ul class="list-group list-group-horizontal">
      {% if task.completed %}
        <li class="list-group-item flex-fill list-group-item-success">
          <strong>Status:</strong>&emsp;Completed
        </li>
        <li class="list-group-item flex-fill list-group-item-success">
          <strong>Date completed:</strong>&emsp;{{ task.date_completed }}
        </li>
        <li class="list-group-item flex-fill list-group-item-success">
          <strong>Completed by:</strong>&emsp;<a href="{% url 'profile' task.completed_by %}">{{ task.completed_by }}</a>
        </li>
      {% else %}
        <li class="list-group-item flex-fill">
          <strong>Status:</strong>&emsp;In-Progress
        </li>
      {% endif %}
    </li>
  </ul>
  <div class="card-footer">
    <a class="btn btn-primary" href="{% url 'task-update' task.id %}">Update</a>
    {% if not task.completed %}
      <a class="btn btn-success" href="{% url 'task-complete' task.id %}">Complete</a>
    {% endif %}
    <a class="btn btn-danger float-right" href="{% url 'task-delete' task.id %}">Delete</a>

  </div>
{% endblock cardContent %}

{% block comments %}
  {% with task.taskcomment_set.all as comments %}
    {% include 'comments/comments.html' %}
  {% endwith %}
{% endblock comments %}
